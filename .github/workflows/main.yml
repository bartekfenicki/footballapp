name: NODE.JS CI/CD Bartek main

on:
    push:
        branches: [main]
        
permissions:
  contents: write

jobs:

  test:

    name: Test on Push Bartek Fenicki
    runs-on: ubuntu-latest

    strategy:
        matrix: 
            node-version: [14.x]
    
    steps:
        - name: Checkout
          uses: actions/checkout@v2
          with: 
            fetch-depth: 0

        - name: use Node.JS ${{ matrix.node-version }}
          uses: actions/setup-node@v2
          with: 
            node-version: ${{ matrix.node-version }}
        
        - name: NPM install, build and test
          run: 
            npm install
            npm test

  deploy:
        name: Deploy to GitHub Pages
        needs: test  # Only run this job if "test" passes
        runs-on: ubuntu-latest
          
        steps:
          - name: Checkout repository
            uses: actions/checkout@v2
          
          - name: Use Node.js
            uses: actions/setup-node@v2
            with:
                node-version: 14.x
          
          - name: Install dependencies
            run: npm install
          
          - name: Build project
            run: npm run build
          
          - name: Deploy to GitHub Pages
            uses: peaceiris/actions-gh-pages@v3
            with:
                github_token: ${{ secrets.GITHUB_TOKEN }}
                publish_dir: ./dist

